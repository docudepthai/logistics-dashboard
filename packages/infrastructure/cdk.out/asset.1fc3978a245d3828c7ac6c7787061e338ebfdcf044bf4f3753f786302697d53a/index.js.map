{
  "version": 3,
  "sources": ["../../../lambda/src/handlers/parasut-webhook.ts", "../../../lambda/src/utils/whatsapp.ts"],
  "sourcesContent": ["/**\n * Parasut Webhook Handler\n * Receives notifications from Parasut when e-archive/e-invoice PDFs are ready\n * Fetches the PDF URL and sends to user via WhatsApp\n */\n\nimport type { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, QueryCommand, UpdateCommand } from '@aws-sdk/lib-dynamodb';\nimport { createParasutService } from '../services/parasut.js';\nimport { sendInvoiceNotification } from '../utils/whatsapp.js';\n\n// DynamoDB client\nconst dynamoClient = new DynamoDBClient({});\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\nconst TABLE_NAME = process.env.CONVERSATIONS_TABLE || 'turkish-logistics-conversations';\n\ninterface ParasutWebhookPayload {\n  event: string;\n  data: {\n    id: string;\n    type: string;\n    attributes?: {\n      pdf_url?: string;\n      status?: string;\n    };\n    relationships?: {\n      sales_invoice?: {\n        data?: {\n          id: string;\n        };\n      };\n    };\n  };\n}\n\n/**\n * Find payment record by e-archive ID\n */\nasync function findPaymentByEArchiveId(eArchiveId: string): Promise<{ merchantOid: string; phoneNumber: string } | null> {\n  // Scan for payment with this e-archive ID\n  // Note: In production, consider using a GSI for this lookup\n  try {\n    const result = await docClient.send(new QueryCommand({\n      TableName: TABLE_NAME,\n      IndexName: 'parasutEArchiveId-index',\n      KeyConditionExpression: 'parasutEArchiveId = :eArchiveId',\n      ExpressionAttributeValues: {\n        ':eArchiveId': eArchiveId,\n      },\n    }));\n\n    const item = result.Items?.[0];\n    if (item) {\n      const merchantOid = (item.pk as string).replace('PAYMENT#', '');\n      return {\n        merchantOid,\n        phoneNumber: item.phoneNumber as string,\n      };\n    }\n  } catch (error) {\n    // GSI might not exist, fall back to scan\n    console.log('GSI lookup failed, trying scan:', error);\n  }\n\n  // Fallback: scan (less efficient but works without GSI)\n  // In a real implementation, you'd want to create the GSI\n  return null;\n}\n\n/**\n * Find payment record by invoice ID\n */\nasync function findPaymentByInvoiceId(invoiceId: string): Promise<{ merchantOid: string; phoneNumber: string } | null> {\n  try {\n    const result = await docClient.send(new QueryCommand({\n      TableName: TABLE_NAME,\n      IndexName: 'parasutInvoiceId-index',\n      KeyConditionExpression: 'parasutInvoiceId = :invoiceId',\n      ExpressionAttributeValues: {\n        ':invoiceId': invoiceId,\n      },\n    }));\n\n    const item = result.Items?.[0];\n    if (item) {\n      const merchantOid = (item.pk as string).replace('PAYMENT#', '');\n      return {\n        merchantOid,\n        phoneNumber: item.phoneNumber as string,\n      };\n    }\n  } catch (error) {\n    console.log('GSI lookup failed:', error);\n  }\n\n  return null;\n}\n\n/**\n * Handle e-archive event (PDF ready)\n */\nasync function handleEArchiveEvent(payload: ParasutWebhookPayload): Promise<void> {\n  const eArchiveId = payload.data.id;\n  const pdfUrl = payload.data.attributes?.pdf_url;\n\n  console.log(`E-Archive event for ${eArchiveId}, PDF URL: ${pdfUrl ? 'available' : 'not available'}`);\n\n  if (!pdfUrl) {\n    console.log('No PDF URL in webhook payload, skipping');\n    return;\n  }\n\n  // Find the payment record for this e-archive\n  const payment = await findPaymentByEArchiveId(eArchiveId);\n\n  if (!payment) {\n    console.log(`No payment found for e-archive ${eArchiveId}`);\n\n    // Try to find by getting invoice ID from e-archive relationship\n    const invoiceId = payload.data.relationships?.sales_invoice?.data?.id;\n    if (invoiceId) {\n      const paymentByInvoice = await findPaymentByInvoiceId(invoiceId);\n      if (paymentByInvoice) {\n        await sendPdfToUser(paymentByInvoice, eArchiveId, pdfUrl);\n        return;\n      }\n    }\n    return;\n  }\n\n  await sendPdfToUser(payment, eArchiveId, pdfUrl);\n}\n\n/**\n * Send PDF to user and update database\n */\nasync function sendPdfToUser(\n  payment: { merchantOid: string; phoneNumber: string },\n  eArchiveId: string,\n  pdfUrl: string\n): Promise<void> {\n  const { merchantOid, phoneNumber } = payment;\n\n  console.log(`Sending PDF to ${phoneNumber} for payment ${merchantOid}`);\n\n  // Send PDF via WhatsApp\n  const sent = await sendInvoiceNotification(phoneNumber, pdfUrl, merchantOid);\n\n  // Update payment record\n  await docClient.send(new UpdateCommand({\n    TableName: TABLE_NAME,\n    Key: { pk: `PAYMENT#${merchantOid}`, sk: 'PENDING' },\n    UpdateExpression: 'SET invoiceStatus = :status, invoicePdfUrl = :pdfUrl, invoiceSentAt = :sentAt, updatedAt = :now',\n    ExpressionAttributeValues: {\n      ':status': sent ? 'sent' : 'pdf_ready',\n      ':pdfUrl': pdfUrl,\n      ':sentAt': sent ? new Date().toISOString() : null,\n      ':now': new Date().toISOString(),\n    },\n  }));\n\n  console.log(`PDF ${sent ? 'sent' : 'not sent'} for payment ${merchantOid}`);\n}\n\n/**\n * Lambda handler\n */\nexport async function handler(event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> {\n  console.log('Parasut webhook received:', event.body);\n\n  try {\n    // Parse webhook payload\n    const payload = JSON.parse(event.body || '{}') as ParasutWebhookPayload;\n\n    if (!payload.event || !payload.data) {\n      console.error('Invalid webhook payload');\n      return {\n        statusCode: 400,\n        body: JSON.stringify({ error: 'Invalid payload' }),\n      };\n    }\n\n    console.log(`Processing Parasut event: ${payload.event}, type: ${payload.data.type}`);\n\n    // Handle different event types\n    switch (payload.event) {\n      case 'e_archive.created':\n      case 'e_archive.updated':\n        await handleEArchiveEvent(payload);\n        break;\n\n      case 'e_invoice.created':\n      case 'e_invoice.updated':\n        // Similar handling for e-invoices\n        await handleEArchiveEvent(payload);\n        break;\n\n      default:\n        console.log(`Unhandled event type: ${payload.event}`);\n    }\n\n    return {\n      statusCode: 200,\n      body: JSON.stringify({ success: true }),\n    };\n  } catch (error) {\n    console.error('Error processing Parasut webhook:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ error: 'Internal server error' }),\n    };\n  }\n}\n", "/**\n * WhatsApp Business API utilities\n * For sending messages and documents to users\n */\n\nconst WHATSAPP_PHONE_NUMBER_ID = process.env.WHATSAPP_PHONE_NUMBER_ID;\nconst WHATSAPP_ACCESS_TOKEN = process.env.WHATSAPP_ACCESS_TOKEN;\n\ninterface WhatsAppMessageResponse {\n  messaging_product: string;\n  contacts: Array<{ input: string; wa_id: string }>;\n  messages: Array<{ id: string }>;\n}\n\ninterface WhatsAppErrorResponse {\n  error: {\n    message: string;\n    type: string;\n    code: number;\n  };\n}\n\n/**\n * Send a text message via WhatsApp\n */\nexport async function sendWhatsAppMessage(to: string, message: string): Promise<boolean> {\n  if (!WHATSAPP_PHONE_NUMBER_ID || !WHATSAPP_ACCESS_TOKEN) {\n    console.warn('WhatsApp: Missing credentials, cannot send message');\n    return false;\n  }\n\n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${WHATSAPP_PHONE_NUMBER_ID}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${WHATSAPP_ACCESS_TOKEN}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to,\n          type: 'text',\n          text: { body: message },\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json() as WhatsAppErrorResponse;\n      console.error('WhatsApp send message error:', error);\n      return false;\n    }\n\n    const data = await response.json() as WhatsAppMessageResponse;\n    console.log(`WhatsApp: Message sent to ${to}, id: ${data.messages?.[0]?.id}`);\n    return true;\n  } catch (error) {\n    console.error('WhatsApp send message failed:', error);\n    return false;\n  }\n}\n\n/**\n * Send a document via WhatsApp\n * @param to - Recipient phone number\n * @param documentUrl - Public URL to the document (PDF, etc.)\n * @param caption - Optional caption for the document\n * @param filename - Filename to display\n */\nexport async function sendWhatsAppDocument(\n  to: string,\n  documentUrl: string,\n  caption: string,\n  filename: string\n): Promise<boolean> {\n  if (!WHATSAPP_PHONE_NUMBER_ID || !WHATSAPP_ACCESS_TOKEN) {\n    console.warn('WhatsApp: Missing credentials, cannot send document');\n    return false;\n  }\n\n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${WHATSAPP_PHONE_NUMBER_ID}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${WHATSAPP_ACCESS_TOKEN}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to,\n          type: 'document',\n          document: {\n            link: documentUrl,\n            caption,\n            filename,\n          },\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json() as WhatsAppErrorResponse;\n      console.error('WhatsApp send document error:', error);\n      return false;\n    }\n\n    const data = await response.json() as WhatsAppMessageResponse;\n    console.log(`WhatsApp: Document sent to ${to}, id: ${data.messages?.[0]?.id}`);\n    return true;\n  } catch (error) {\n    console.error('WhatsApp send document failed:', error);\n    return false;\n  }\n}\n\n/**\n * Send an image via WhatsApp\n * @param to - Recipient phone number\n * @param imageUrl - Public URL to the image\n * @param caption - Optional caption for the image\n */\nexport async function sendWhatsAppImage(\n  to: string,\n  imageUrl: string,\n  caption?: string\n): Promise<boolean> {\n  if (!WHATSAPP_PHONE_NUMBER_ID || !WHATSAPP_ACCESS_TOKEN) {\n    console.warn('WhatsApp: Missing credentials, cannot send image');\n    return false;\n  }\n\n  try {\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${WHATSAPP_PHONE_NUMBER_ID}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${WHATSAPP_ACCESS_TOKEN}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to,\n          type: 'image',\n          image: {\n            link: imageUrl,\n            caption,\n          },\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json() as WhatsAppErrorResponse;\n      console.error('WhatsApp send image error:', error);\n      return false;\n    }\n\n    const data = await response.json() as WhatsAppMessageResponse;\n    console.log(`WhatsApp: Image sent to ${to}, id: ${data.messages?.[0]?.id}`);\n    return true;\n  } catch (error) {\n    console.error('WhatsApp send image failed:', error);\n    return false;\n  }\n}\n\n/**\n * Send invoice notification with PDF\n */\nexport async function sendInvoiceNotification(\n  to: string,\n  pdfUrl: string,\n  merchantOid: string\n): Promise<boolean> {\n  const caption = `Faturanƒ±z hazƒ±r!\\n\\nSipari≈ü No: ${merchantOid}\\n\\nPatron Premium √ºyeliƒüiniz i√ßin te≈üekk√ºr ederiz. üôè`;\n  const filename = `fatura-${merchantOid}.pdf`;\n\n  return sendWhatsAppDocument(to, pdfUrl, caption, filename);\n}\n\n/**\n * Send payment success notification (without PDF)\n */\nexport async function sendPaymentSuccessNotification(to: string): Promise<boolean> {\n  const message = `‚úÖ √ñdemeniz ba≈üarƒ±yla alƒ±ndƒ±!\\n\\nPremium √ºyeliƒüiniz aktif edildi. Artƒ±k t√ºm telefon numaralarƒ±nƒ± g√∂rebilirsiniz.\\n\\nSorularƒ±nƒ±z i√ßin WhatsApp'tan bize ula≈üabilirsiniz: +90 533 208 9867`;\n\n  return sendWhatsAppMessage(to, message);\n}\n\n/**\n * Send invoice generation failure notification\n */\nexport async function sendInvoiceFailureNotification(to: string): Promise<boolean> {\n  const message = `‚ö†Ô∏è Faturanƒ±z ≈üu anda olu≈üturulamadƒ±.\\n\\nEndi≈üelenmeyin, √∂demeniz ba≈üarƒ±lƒ± ve premium √ºyeliƒüiniz aktif. Faturanƒ±z en kƒ±sa s√ºrede manuel olarak olu≈üturulup g√∂nderilecektir.\\n\\nSorularƒ±nƒ±z i√ßin WhatsApp'tan bize ula≈üabilirsiniz: +90 533 208 9867`;\n\n  return sendWhatsAppMessage(to, message);\n}\n\n/**\n * Send an interactive message with a CTA URL button\n * @param to - Recipient phone number\n * @param headerText - Header text (optional)\n * @param bodyText - Main message body\n * @param footerText - Footer text (optional)\n * @param buttonText - Text on the button\n * @param buttonUrl - URL to open when button is clicked\n */\nexport async function sendWhatsAppButtonMessage(\n  to: string,\n  bodyText: string,\n  buttonText: string,\n  buttonUrl: string,\n  headerText?: string,\n  footerText?: string\n): Promise<boolean> {\n  if (!WHATSAPP_PHONE_NUMBER_ID || !WHATSAPP_ACCESS_TOKEN) {\n    console.warn('WhatsApp: Missing credentials, cannot send button message');\n    return false;\n  }\n\n  try {\n    const interactive: {\n      type: string;\n      header?: { type: string; text: string };\n      body: { text: string };\n      footer?: { text: string };\n      action: {\n        name: string;\n        parameters: {\n          display_text: string;\n          url: string;\n        };\n      };\n    } = {\n      type: 'cta_url',\n      body: { text: bodyText },\n      action: {\n        name: 'cta_url',\n        parameters: {\n          display_text: buttonText,\n          url: buttonUrl,\n        },\n      },\n    };\n\n    if (headerText) {\n      interactive.header = { type: 'text', text: headerText };\n    }\n    if (footerText) {\n      interactive.footer = { text: footerText };\n    }\n\n    const response = await fetch(\n      `https://graph.facebook.com/v18.0/${WHATSAPP_PHONE_NUMBER_ID}/messages`,\n      {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${WHATSAPP_ACCESS_TOKEN}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to,\n          type: 'interactive',\n          interactive,\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json() as WhatsAppErrorResponse;\n      console.error('WhatsApp send button message error:', error);\n      return false;\n    }\n\n    const data = await response.json() as WhatsAppMessageResponse;\n    console.log(`WhatsApp: Button message sent to ${to}, id: ${data.messages?.[0]?.id}`);\n    return true;\n  } catch (error) {\n    console.error('WhatsApp send button message failed:', error);\n    return false;\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAOA,IAAAI,EAA+B,oCAC/BC,EAAoE,iCCHpE,IAAMC,EAA2B,QAAQ,IAAI,yBACvCC,EAAwB,QAAQ,IAAI,sBAiE1C,eAAsBC,EACpBC,EACAC,EACAC,EACAC,EACkB,CAClB,GAAI,CAACC,GAA4B,CAACC,EAChC,eAAQ,KAAK,qDAAqD,EAC3D,GAGT,GAAI,CACF,IAAMC,EAAW,MAAM,MACrB,oCAAoCF,CAAwB,YAC5D,CACE,OAAQ,OACR,QAAS,CACP,cAAe,UAAUC,CAAqB,GAC9C,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,kBAAmB,WACnB,GAAAL,EACA,KAAM,WACN,SAAU,CACR,KAAMC,EACN,QAAAC,EACA,SAAAC,CACF,CACF,CAAC,CACH,CACF,EAEA,GAAI,CAACG,EAAS,GAAI,CAChB,IAAMC,EAAQ,MAAMD,EAAS,KAAK,EAClC,eAAQ,MAAM,gCAAiCC,CAAK,EAC7C,EACT,CAEA,IAAMC,EAAO,MAAMF,EAAS,KAAK,EACjC,eAAQ,IAAI,8BAA8BN,CAAE,SAASQ,EAAK,WAAW,CAAC,GAAG,EAAE,EAAE,EACtE,EACT,OAASD,EAAO,CACd,eAAQ,MAAM,iCAAkCA,CAAK,EAC9C,EACT,CACF,CAyDA,eAAsBE,EACpBC,EACAC,EACAC,EACkB,CAClB,IAAMC,EAAU;AAAA;AAAA,cAAmCD,CAAW;AAAA;AAAA,oDACxDE,EAAW,UAAUF,CAAW,OAEtC,OAAOG,EAAqBL,EAAIC,EAAQE,EAASC,CAAQ,CAC3D,CD1KA,IAAME,EAAe,IAAI,iBAAe,CAAC,CAAC,EACpCC,EAAY,yBAAuB,KAAKD,CAAY,EACpDE,EAAa,QAAQ,IAAI,qBAAuB,kCAwBtD,eAAeC,EAAwBC,EAAkF,CAGvH,GAAI,CAUF,IAAMC,GATS,MAAMJ,EAAU,KAAK,IAAI,eAAa,CACnD,UAAWC,EACX,UAAW,0BACX,uBAAwB,kCACxB,0BAA2B,CACzB,cAAeE,CACjB,CACF,CAAC,CAAC,GAEkB,QAAQ,CAAC,EAC7B,GAAIC,EAEF,MAAO,CACL,YAFmBA,EAAK,GAAc,QAAQ,WAAY,EAAE,EAG5D,YAAaA,EAAK,WACpB,CAEJ,OAASC,EAAO,CAEd,QAAQ,IAAI,kCAAmCA,CAAK,CACtD,CAIA,OAAO,IACT,CAKA,eAAeC,EAAuBC,EAAiF,CACrH,GAAI,CAUF,IAAMH,GATS,MAAMJ,EAAU,KAAK,IAAI,eAAa,CACnD,UAAWC,EACX,UAAW,yBACX,uBAAwB,gCACxB,0BAA2B,CACzB,aAAcM,CAChB,CACF,CAAC,CAAC,GAEkB,QAAQ,CAAC,EAC7B,GAAIH,EAEF,MAAO,CACL,YAFmBA,EAAK,GAAc,QAAQ,WAAY,EAAE,EAG5D,YAAaA,EAAK,WACpB,CAEJ,OAASC,EAAO,CACd,QAAQ,IAAI,qBAAsBA,CAAK,CACzC,CAEA,OAAO,IACT,CAKA,eAAeG,EAAoBC,EAA+C,CAChF,IAAMN,EAAaM,EAAQ,KAAK,GAC1BC,EAASD,EAAQ,KAAK,YAAY,QAIxC,GAFA,QAAQ,IAAI,uBAAuBN,CAAU,cAAcO,EAAS,YAAc,eAAe,EAAE,EAE/F,CAACA,EAAQ,CACX,QAAQ,IAAI,yCAAyC,EACrD,MACF,CAGA,IAAMC,EAAU,MAAMT,EAAwBC,CAAU,EAExD,GAAI,CAACQ,EAAS,CACZ,QAAQ,IAAI,kCAAkCR,CAAU,EAAE,EAG1D,IAAMI,EAAYE,EAAQ,KAAK,eAAe,eAAe,MAAM,GACnE,GAAIF,EAAW,CACb,IAAMK,EAAmB,MAAMN,EAAuBC,CAAS,EAC/D,GAAIK,EAAkB,CACpB,MAAMC,EAAcD,EAAkBT,EAAYO,CAAM,EACxD,MACF,CACF,CACA,MACF,CAEA,MAAMG,EAAcF,EAASR,EAAYO,CAAM,CACjD,CAKA,eAAeG,EACbF,EACAR,EACAO,EACe,CACf,GAAM,CAAE,YAAAI,EAAa,YAAAC,CAAY,EAAIJ,EAErC,QAAQ,IAAI,kBAAkBI,CAAW,gBAAgBD,CAAW,EAAE,EAGtE,IAAME,EAAO,MAAMC,EAAwBF,EAAaL,EAAQI,CAAW,EAG3E,MAAMd,EAAU,KAAK,IAAI,gBAAc,CACrC,UAAWC,EACX,IAAK,CAAE,GAAI,WAAWa,CAAW,GAAI,GAAI,SAAU,EACnD,iBAAkB,kGAClB,0BAA2B,CACzB,UAAWE,EAAO,OAAS,YAC3B,UAAWN,EACX,UAAWM,EAAO,IAAI,KAAK,EAAE,YAAY,EAAI,KAC7C,OAAQ,IAAI,KAAK,EAAE,YAAY,CACjC,CACF,CAAC,CAAC,EAEF,QAAQ,IAAI,OAAOA,EAAO,OAAS,UAAU,gBAAgBF,CAAW,EAAE,CAC5E,CAKA,eAAsBI,EAAQC,EAA6D,CACzF,QAAQ,IAAI,4BAA6BA,EAAM,IAAI,EAEnD,GAAI,CAEF,IAAMV,EAAU,KAAK,MAAMU,EAAM,MAAQ,IAAI,EAE7C,GAAI,CAACV,EAAQ,OAAS,CAACA,EAAQ,KAC7B,eAAQ,MAAM,yBAAyB,EAChC,CACL,WAAY,IACZ,KAAM,KAAK,UAAU,CAAE,MAAO,iBAAkB,CAAC,CACnD,EAMF,OAHA,QAAQ,IAAI,6BAA6BA,EAAQ,KAAK,WAAWA,EAAQ,KAAK,IAAI,EAAE,EAG5EA,EAAQ,MAAO,CACrB,IAAK,oBACL,IAAK,oBACH,MAAMD,EAAoBC,CAAO,EACjC,MAEF,IAAK,oBACL,IAAK,oBAEH,MAAMD,EAAoBC,CAAO,EACjC,MAEF,QACE,QAAQ,IAAI,yBAAyBA,EAAQ,KAAK,EAAE,CACxD,CAEA,MAAO,CACL,WAAY,IACZ,KAAM,KAAK,UAAU,CAAE,QAAS,EAAK,CAAC,CACxC,CACF,OAASJ,EAAO,CACd,eAAQ,MAAM,oCAAqCA,CAAK,EACjD,CACL,WAAY,IACZ,KAAM,KAAK,UAAU,CAAE,MAAO,uBAAwB,CAAC,CACzD,CACF,CACF",
  "names": ["parasut_webhook_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "WHATSAPP_PHONE_NUMBER_ID", "WHATSAPP_ACCESS_TOKEN", "sendWhatsAppDocument", "to", "documentUrl", "caption", "filename", "WHATSAPP_PHONE_NUMBER_ID", "WHATSAPP_ACCESS_TOKEN", "response", "error", "data", "sendInvoiceNotification", "to", "pdfUrl", "merchantOid", "caption", "filename", "sendWhatsAppDocument", "dynamoClient", "docClient", "TABLE_NAME", "findPaymentByEArchiveId", "eArchiveId", "item", "error", "findPaymentByInvoiceId", "invoiceId", "handleEArchiveEvent", "payload", "pdfUrl", "payment", "paymentByInvoice", "sendPdfToUser", "merchantOid", "phoneNumber", "sent", "sendInvoiceNotification", "handler", "event"]
}

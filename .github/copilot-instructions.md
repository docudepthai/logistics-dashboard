# GitHub Copilot Instructions - Generated by DocuDepth

# Whatsapp_Aggregator_Bot - Codebase Context

> Generated by DocuDepth AI - https://docudepthai.com
> Last updated: 2026-01-14T19:40:45.518Z

## Project Overview

**Whatsapp_Aggregator_Bot**

20 distinct modules. Modularizes parsing logic for individual fields in logistics messages.

| Attribute | Value |
|-----------|-------|
| Primary Language | typescript |
| Architecture | Modular |
| Framework | nodejs |
| Total Files | 3 |

## Domain Context

Modularizes parsing logic for individual fields in logistics messages.

Defines the PostgreSQL schema for logistics data persistence.

Debug/visualize deployed AWS infrastructure from CDK synth.

## Architecture

**Style:** Modular

20 distinct modules.

## Key Files

### Configuration

- `.aider/context.md` - AI-generated codebase context summary for Aider coding assistant.
- `.github/copilot-instructions.md` - AI-generated codebase context instructions for GitHub Copilot.
- `CLAUDE.md` - AI-generated codebase context summary for Claude AI.

## Modules

### extractors

- **Path:** `packages/parser/src/extractors`
- **Role:** Extracts contact names from messages.
- **Business Context:** Modularizes parsing logic for individual fields in logistics messages.
- **Key Exports:** extractContact (function), extractLocations (function), determineOriginDestination (function), extractUrgency (function), extractCargoType (function), hasCargoAvailable (function), extractVehicle (function), isVehicleWanted (function), isVehicleAvailable (function), extractWeight (function)

### schema

- **Path:** `packages/database/src/schema`
- **Role:** Drizzle schema for deduped contacts table.
- **Business Context:** Defines the PostgreSQL schema for logistics data persistence.
- **Key Exports:** contacts (function), processingLogs (function), jobs (function), sourceGroups (function), rawMessages (function), districts (function)

### cdk.out

- **Path:** `packages/infrastructure/cdk.out`
- **Role:** Generated CDK synthesis tree of AWS resources.
- **Business Context:** Debug/visualize deployed AWS infrastructure from CDK synth.

### src

- **Path:** `packages/parser/src`
- **Role:** Calculates confidence scores for parsed messages.
- **Business Context:** Provides the core NLP-like parsing engine for Turkish logistics WhatsApp messages used in processor Lambda.
- **Key Exports:** calculateConfidence (function), parseWithAI (function), isAIParsingAvailable (function), parse (function), parseMany (function), isLikelyLogisticsMessage (function)

### constants

- **Path:** `packages/shared/src/constants`
- **Role:** Barrel exporting all geography and vehicle constants.
- **Business Context:** Centralizes Turkish-specific data for consistent use across parser and agent.
- **Key Exports:** getDistrictsByName (function), getDistrictByName (function), isDistrictName (function), isAmbiguousDistrict (function), getDistrictsByProvinceCode (function), District (interface), getProvinceByName (function), getProvinceByCode (function), isProvinceName (function), Province (interface)

### types

- **Path:** `packages/shared/src/types`
- **Role:** Database entity interfaces (Job, RawMessage, etc.).
- **Business Context:** Ensures type consistency across packages for parsed data and API payloads.
- **Key Exports:** RawMessage (interface), Job (interface), SourceGroup (interface), ProvinceRecord (interface), DistrictRecord (interface), ProcessingLog (interface), isMessagesUpsertEvent (function), isGroupMessage (function), isOwnMessage (function), extractTextFromMessage (function)

### extractors

- **Path:** `packages/parser/src/__tests__/extractors`
- **Role:** Unit tests for phone extraction.
- **Business Context:** Validates phone utils.

### infrastructure

- **Path:** `packages/infrastructure`
- **Role:** TypeScript config for infrastructure package with CDK outputs.
- **Business Context:** Compiles CDK TypeScript to JS for AWS deployment.

### src

- **Path:** `packages/agent/src`
- **Role:** Core LogisticsAgent class using OpenAI for job queries.
- **Business Context:** Facilitates modular usage of the AI agent for querying logistics jobs via WhatsApp.
- **Key Exports:** LogisticsAgent (class), AgentOptions (interface), AgentResponse (interface), ConversationStore (class), Message (interface), ConversationContext (interface), Conversation (interface)

### handlers

- **Path:** `packages/lambda/src/handlers`
- **Role:** TypeScript source for message processor Lambda.
- **Business Context:** Transforms raw WhatsApp messages into structured jobs.
- **Key Exports:** handler (function), handler (function), handler (function)

### database

- **Path:** `packages/database`
- **Role:** Drizzle Kit config for schema migrations.
- **Business Context:** Automates DB migrations/push for dev/prod.

### utils

- **Path:** `packages/shared/src/utils`
- **Role:** Turkish text normalization and suffix stripping utils.
- **Business Context:** Handles Turkish character normalization and phone formatting for robust parsing.
- **Key Exports:** normalizeToAscii (function), stripSuffix (function), normalizeLocationName (function), hasOriginSuffix (function), hasDestinationSuffix (function), extractDirectionIndicators (function), extractPhoneNumbers (function), normalizePhoneNumber (function), formatPhoneNumber (function), isValidTurkishMobile (function)

### queries

- **Path:** `packages/database/src/queries`
- **Role:** Job CRUD and filter queries.
- **Business Context:** Provides typed query APIs for jobs and raw messages used by agent and processor.
- **Key Exports:** insertJob (function), getJobByMessageId (function), jobExists (function), getJobs (function), getJobsByRoute (function), deactivateOldJobs (function), getJobStats (function), JobFilters (interface), insertRawMessage (function), getRawMessageByMessageId (function)

### asset.87133ce00a5c5401f972406a5581616bf4d54c839cf0b2bef1d8e7ad1047427c

- **Path:** `packages/infrastructure/cdk.out/asset.87133ce00a5c5401f972406a5581616bf4d54c839cf0b2bef1d8e7ad1047427c`
- **Role:** Bundled processor Lambda handler for parsing and DB storage.
- **Business Context:** Core processing logic deployed as Lambda, triggered by SQS.
- **Key Exports:** handler (function), handler (function)

### agent

- **Path:** `packages/agent`
- **Role:** TypeScript config for agent package (GPT conversations).
- **Business Context:** Compiles agent code for Lambda/DynamoDB interactions.

### lambda

- **Path:** `packages/lambda`
- **Role:** Package config for Lambda handlers.
- **Business Context:** Compiles handlers for webhook/processor Lambdas.

### parser

- **Path:** `packages/parser`
- **Role:** Package config for logistics message parser.
- **Business Context:** Parses WhatsApp texts into structured job data.

### tools

- **Path:** `packages/agent/src/tools`
- **Role:** Database-backed job search tool for OpenAI function calling.
- **Business Context:** Modular tools for OpenAI function calling in agent.
- **Key Exports:** searchJobs (function), getJobById (function), countJobs (function), SearchJobsParams (interface), JobResult (interface), SearchJobsResult (interface)

### shared

- **Path:** `packages/shared`
- **Role:** Shared utilities package config with subpath exports.
- **Business Context:** Common Turkish location/phone utils across packages.

### docs

- **Path:** `docs`
- **Role:** Documentation of overall system architecture and flow.
- **Business Context:** Onboarding and troubleshooting guide.

## Code Patterns & Conventions

### minified-bundle

Pattern: minified-bundle

**Used in:** packages/infrastructure/cdk.out/asset.afe5ad7389ef42fd1d9e5df697d9636fb78db1a7efd76b5ae82c6491087121b1/index.js, packages/infrastructure/cdk.out/asset.c718b8f92df07fea3a7f15692ac85a85c4db0a6b1fb5c33ac12f85896eb69b4f/index.js, packages/infrastructure/cdk.out/asset.290362cf8f0368a6b23fb0c804b03960f4f856393a9bf5702721bd362e9a512c/index.js

### lookup-tables

Pattern: lookup-tables

**Used in:** packages/infrastructure/cdk.out/asset.afe5ad7389ef42fd1d9e5df697d9636fb78db1a7efd76b5ae82c6491087121b1/index.js, packages/infrastructure/cdk.out/asset.c718b8f92df07fea3a7f15692ac85a85c4db0a6b1fb5c33ac12f85896eb69b4f/index.js

### event-handler

Pattern: event-handler

**Used in:** packages/infrastructure/cdk.out/asset.afe5ad7389ef42fd1d9e5df697d9636fb78db1a7efd76b5ae82c6491087121b1/index.js, packages/infrastructure/cdk.out/asset.c718b8f92df07fea3a7f15692ac85a85c4db0a6b1fb5c33ac12f85896eb69b4f/index.js

### index-barrel

Pattern: index-barrel

**Used in:** packages/agent/src/index.ts, packages/lambda/src/index.ts, packages/shared/src/index.ts

### pattern-match

Pattern: pattern-match

**Used in:** packages/shared/src/constants/vehicles.ts, packages/parser/src/extractors/urgency.ts

### markdown

Pattern: markdown

**Used in:** docs/SYSTEM_ARCHITECTURE.md, docs/evolution-api-setup.md

### monorepo workspace package

Pattern: monorepo workspace package

**Used in:** packages/infrastructure/package.json, package.json

### subpath exports

Pattern: subpath exports

**Used in:** packages/shared/package.json, packages/database/package.json

### project references

Pattern: project references

**Used in:** packages/parser/tsconfig.json, packages/database/tsconfig.json

## AI Guidance

### Must Follow

- Follow existing code style and conventions
- Add appropriate error handling
- Write tests for new functionality

### Must Avoid

- Do not introduce new dependencies without consideration
- Avoid duplicating existing functionality
- Do not hardcode configuration values

---

## How to Use This Context

This file provides your AI coding assistant with deep understanding of this codebase.
The AI will automatically use this context to:

- Understand the project structure and architecture
- Follow existing code patterns and conventions
- Make accurate suggestions that fit the codebase
- Navigate between related files and modules

For full details, check `.docudepth/context-map.json`.

*This file is auto-generated and updated by DocuDepth. Do not edit manually.*
